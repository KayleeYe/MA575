---
title: "report4"
author: "Viktoria Zruttova"
date: "2024-04-07"
output: html_document
---
```{r}
library(car)
library(caret)
library(ggplot2)
library(dplyr)
library(GGally)
library(readxl)
```


```{r}
#load the dataset
mydata <- read.csv('./data/day.csv')

```
```{r}
#convert 'dteday' column to Date format
mydata$dteday <- as.Date(mydata$dteday)

#season
mydata$season <- cut(mydata$season,
                     breaks = c(0.5, 1.5, 2.5, 3.5, 4.5),
                     labels = c("Winter", "Spring", "Summer", "Fall"))
mydata$season <- factor(mydata$season, levels = c("Winter", "Spring", "Summer", "Fall"))

#workingday
mydata$workingday <- ifelse(mydata$workingday == 0, "Not_Workingday", "Workingday")
mydata$workingday <- factor(mydata$workingday, levels = c("Not_Workingday", "Workingday"))

#weather
mydata$weathersit <- cut(mydata$weathersit,
                         breaks = c(0.5, 1.5, 2.5, 3.5, 4.5),
                         labels = c("Weather_1", "Weather_2", "Weather_3", "Weather_4"))
mydata$weathersit <- factor(mydata$weathersit, levels = c("Weather_1", "Weather_2", "Weather_3", "Weather_4"))

head(mydata)
```


```{r}



#split the dataset into training and validation sets
training_data <- mydata[mydata$yr == 0, ]
validation_data <- mydata[mydata$yr == 1, ]


```
```{r}
# Set a seed for reproducibility
# Setting a seed is crucial for reproducibility and consistency of results.
# It ensures that when you run the same code multiple times, you'll ...
# ... obtain the same results.
set.seed(20231103)

# Filter dataset for year 2011 (0) and year 2012 (1)
year2011 <- mydata[mydata$yr == 0, ]
year2012 <- mydata[mydata$yr == 1, ]

# Add 'Type' column and assign values
year2011$Type <- "Training"
year2012$Type <- "Validation"

# Combine training and validation data
mydata <- rbind(year2011, year2012)

```

## Boxplots for proposed covariates y

We choose 3 questions of interest:

1. **How does working day affect the number of registered users?** where Y is the numnber of registered users
2. **How does season affect the number of casual users?** where Y is the sqrt(casual users)
3. **Is weather correlated to the number of bike rentals?* ** where Y is the count of bikes rented 

comment - we probably need to do stratified sampling as in lab 9, since we do not have equal representation in both training and validation datasets. We should address this issue

```{r}
#cnt
ggplot(mydata, aes(x = Type, y = cnt, color = Type)) +
  geom_boxplot(position = position_dodge(width = 0.8)) +
  labs(x = "Type", y = "# Total Users") +
  scale_fill_manual(name = "Dataset Type", values = c("Training" = "blue", "Validation" = "red")) +
  ggtitle("# Total Users by Type (Training vs. Validation)") +
  theme_bw()

#registered
ggplot(mydata, aes(x = Type, y = registered, color = Type)) +
  geom_boxplot(position = position_dodge(width = 0.8)) +
  labs(x = "Type", y = "# Registered Users") +
  scale_fill_manual(name = "Dataset Type", values = c("Training" = "blue", "Validation" = "red")) +
  ggtitle("# Registered Users by Type (Training vs. Validation)") +
  theme_bw()

#sqrt(casual)
ggplot(mydata, aes(x = Type, y = sqrt(casual), color = Type)) +
  geom_boxplot(position = position_dodge(width = 0.8)) +
  labs(x = "Type", y = "Square Root # Casual Users") +
  scale_fill_manual(name = "Dataset Type", values = c("Training" = "blue", "Validation" = "red")) +
  ggtitle("Square Root # Casual Users by Type (Training vs. Validation)") +
  theme_bw()

```

```{r}
#creating training data our of mydata (training -> data from 2011)
training_data <- subset(mydata, Type == "Training")
summary(training_data)
```

## Full models for each question

```{r}
#fit full model which will be used to stepwise regression later

full_model1 <- lm(registered ~ workingday ++ season+ mnth + holiday + weekday + temp + atemp + hum + windspeed + cnt + weathersit,
                 data = training_data)

full_model2 <- lm( sqrt(casual)~ workingday +registered + season+ mnth + holiday + weekday + temp + atemp + hum + windspeed + cnt + weathersit,
                 data = training_data)

full_model3 <- lm( cnt ~ casual +workingday +registered + season+ mnth + holiday + weekday + temp + atemp + hum + windspeed + cnt + weathersit,
                 data = training_data)

summary(full_model1)
summary(full_model2)
summary(full_model3)

#plot added variables
avPlots(full_model1)
avPlots(full_model2)
avPlots(full_model3)
```


# Stepwise Regression

```{r}
stepwise_model1 <- step(full_model1, direction = "both")
stepwise_model2 <- step(full_model2, direction = "both")
stepwise_model3 <- step(full_model3, direction = "both")
```

```{r}
summary(stepwise_model1)
summary(stepwise_model2)
summary(stepwise_model3)
```
```{r}
avPlots(stepwise_model1)
avPlots(stepwise_model2)
avPlots(stepwise_model3)
```

