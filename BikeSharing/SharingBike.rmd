---
title: 'Bike Sharing'
author: "MA575 Group1"
date: "Sunday, February 11, 2024"
output:
  html_document:
    toc: yes
    toc_depth: 2
---

## Running Code

When you click the **Render** button a document will be generated that includes both content and the output of embedded code. You can embed code like this:

```{r}
#install.packages(c("vctrs","maxLik","miscTools","car","carData"))
library(ggplot2)
library(readxl)
library(car)
#library(GGally)
```

The `echo: false` option disables the printing of code (only output is displayed).

```{r}
datasetBike <- read.csv('../data/day.csv')
head(datasetBike)
```

```{r}
season = datasetBike$season #season: (1:winter, 2:spring, 3:summer, 4:fall)
yr = datasetBike$yr #year: year (0: 2011, 1:2012)
month = datasetBike$mnth #month ( 1 to 12)
holiday = datasetBike$holiday #weather day is holiday or not (extracted from http://dchr.dc.gov/page/holiday-schedule)
wkday= datasetBike$weekday #day of the week (0=Sunday, 1=Monday,..., 6=Saturday)
workingday = datasetBike$workingday #if day is neither weekend nor holiday is 1, otherwise is 0.
weather = datasetBike$weathersit
#1: Clear, Few clouds, Partly cloudy, Partly cloudy
#2: Mist + Cloudy, Mist + Broken clouds, Mist + Few clouds, Mist
#3: Light Snow, Light Rain + Thunderstorm + Scattered clouds, Light Rain + Scattered clouds
#4: Heavy Rain + Ice Pallets + Thunderstorm + Mist, Snow + Fog
temp = datasetBike$temp
#Normalized temperature in Celsius. The values are derived via (t-t_min)/(t_max-t_min), 
#t_min=-8, t_max=+39 (only in hourly scale)
atemp = datasetBike$atemp
#Normalized feeling temperature in Celsius. The values are derived via (t-t_min)/(t_max-t_min), 
#t_min=-16, t_max=+50 (only in hourly scale)
hum = datasetBike$hum #Normalized humidity. The values are divided to 100 (max)
wind = datasetBike$windspeed # Normalized wind speed. The values are divided to 67 (max)
casual = datasetBike$casual #count of casual users
registered = datasetBike$registered #count of registered users
cnt = datasetBike$cnt #the total rental bikes including both casual and registered
```

## Descriptive Statistics

```{r}
summary(cnt)
hist(cnt, main = "Histogram of Number of Bikes Rented per Day", xlab= "number of bikes")
```

## The Holiday vs cnt

```{r}
summary(holiday)

# Calculate the frequency of holidays
freq_table <- table(holiday)
num_zeros <- freq_table[["0"]]
num_ones <- freq_table[["1"]]
print(paste("Number of non-holidays:", num_zeros))
print(paste("Number of holidays:", num_ones))
#show proportion of holidays
holiday_proportion <- prop.table(table(holiday))
"The proportion of holidays"
print(holiday_proportion)
#show histogram of holiday
hist(holiday)


#Plot the number of bikes rented on holiday (which is either 0 or 1)
ggplot(datasetBike, aes(x = dteday, y = cnt, fill = factor(holiday))) +
  geom_bar(stat = "identity") +
  labs(x = "Date", y = "Number of Bikes Rented", title = "Number of Bikes Rented on Holidays") +
  scale_fill_manual(values = c("0" = "yellow", "1" = "blue")) +
  theme_minimal()

```

```{r}
#box plot
# Filter the data for holidays
holiday_data <- subset(datasetBike, holiday == 1)
non_holiday_data <- subset(datasetBike, holiday == 0)
print("for holiday")
summary(holiday_data$cnt)
print("for non holiday")
summary(non_holiday_data$cnt)

ggplot() +
  geom_boxplot(data = holiday_data, aes(x = "Holiday", y = cnt), fill = "skyblue") +
  geom_boxplot(data = non_holiday_data, aes(x = "Non-Holiday", y = cnt), fill = "lightgreen") +
  labs(x = "Holiday[1]", y = "Number of Bikes Rented", title = "Box Plot of Bikes Rented on Holidays vs Non-Holidays") +
  theme_minimal() + facet_wrap(~holiday)
```

```{r}
m.ols <- lm(cnt ~ holiday, data = datasetBike)
summary(m.ols)
```

## The Day of the Week vs cnt

```{r}
#descriptive stats for Weekday
summary(wkday)
hist(wkday)
sunday <- sum(wkday==0) #105
sunday
monday <- sum(wkday==1) #105
monday
tues <- sum(wkday==2) #105
tues #104
weds <- sum(wkday==3)
weds #104
thurs <- sum(wkday==3)
thurs #104
fri <- sum(wkday==3)
fri #104
sat <- sum(wkday==3)
sat #104
```

```{r}

#Descriptive Stats for Weather
#weather (categorical, 1-4 with a higher number indicating worse weather)
hist(weather)
one <- sum(weather==1)
one #463
two <- sum(weather==2)
two #247
three <- sum(weather==3)
three #21

#Descriptive Stats for wind
#windspeed (continuous)
hist(wind)
summary(wind)

#Descriptive Stats for Tempertature
#temperature (Celsius, continuous)
hist(temp)
summary(temp)

#Descriptive Stats for Feelig Temperature
#feeling temperature (Celsius, continuous)
hist(atemp)
summary(atemp)

##Descriptive Stats for Humidity
#humidity (continuous)
hist(hum)
summary(hum)
```

```{r}
library(readxl)
library(car)
library (ggplot2)
model1 <- lm(cnt~holiday)
summary(model1)
scatterplot(wkday,cnt,xlab="Day of the Week",ylab="Cnt")
model2 <- lm(cnt~wkday)
summary(model2)
scatterplot(weather,cnt,xlab="Weather",ylab="Cnt")
model3 <- lm(cnt~weather)
summary(model3)
```

```{r}
library(ggplot2)
ggplot(datasetBike, aes(x = temp, y = cnt)) +
  geom_point() +
  labs(title = "Scatterplot of Number of Bikes Rented over Temperature",
       x = "Temperature",
       y = "Number of Bikes Rented") +
  theme_minimal()
```

## Split the data by seasons

```{r}
#adding vertical dashed lines at specified positions within the combined data range
#abline(v = c(79, 172, 266, 445, 631), lty = "dashed")
scatterplot(datasetBike$instant, cnt,
            xlab = "Date",
            ylab = "Number of Bikes Rented",
            main = "Scatter Plot of Number of Bikes Rented vs. Date")
abline(v = 79, lty = "dashed")
abline(v = 172, lty = "dashed")
abline(v = 266, lty = "dashed")
abline(v = 356, lty = "dashed")
abline(v = 445, lty = "dashed")
abline(v = 537, lty = "dashed")
abline(v = 631, lty = "dashed")
abline(v = 721, lty = "dashed")

#Spring Summer
subset1 <- datasetBike[datasetBike$instant >= 79 & datasetBike$instant <= 266, ]
subset2 <- datasetBike[datasetBike$instant >= 445 & datasetBike$instant <= 631, ]

# Step 2: Combine the subsets
combinedData <- rbind(subset1, subset2)
# Step 3: Plot the scatter plot with the combined data
plot(combinedData$instant, combinedData$cnt,  # Adjust 'cnt' if it's in a different data structure
     xlab = "Instant",
     ylab = "Number of Bikes Rented",
     main = "Scatter Plot for # of Bikes Rented in Spring & Summer vs. Instant",
     pch = 19)  # pch = 19 makes the points solid circles for better visibility
```

## Box Plots

```{r}
boxplot(temp, main="Boxplot of Temperature", xlab="Temperature", horizontal = TRUE)
# Get the summary of the temperature
temp_summary <- summary(temp)
# Construct the summary text
summary_text <- paste("Min:", temp_summary["Min."], 
                      "1st Qu.:", temp_summary["1st Qu."], 
                      "Median:", temp_summary["Median"], 
                      "Mean:", temp_summary["Mean"],
                      "3rd Qu.:", temp_summary["3rd Qu."], 
                      "Max:", temp_summary["Max."])
# Place the summary text below the boxplot
mtext(summary_text, side = 1, line = 4, cex = 0.7)


boxplot(atemp, main="Boxplot of Feeling Temperature", xlab="Feeling Temperature", horizontal = TRUE)
atemp_summary <-summary(atemp)
summary_text2 <- paste("Min:", atemp_summary["Min."], 
                      "1st Qu.:", atemp_summary["1st Qu."], 
                      "Median:", atemp_summary["Median"], 
                      "Mean:", atemp_summary["Mean"],
                      "3rd Qu.:", atemp_summary["3rd Qu."], 
                      "Max:", atemp_summary["Max."])
# Place the summary text below the boxplot
mtext(summary_text2, side = 1, line = 4, cex = 0.7)

boxplot(wind, main="Boxplot of Wind Speed", xlab="Wind Speed", horizontal = TRUE)
wind_summary <-summary(wind)
summary_text3 <- paste("Min:", wind_summary["Min."], 
                      "1st Qu.:", wind_summary["1st Qu."], 
                      "Median:", wind_summary["Median"], 
                      "Mean:", wind_summary["Mean"],
                      "3rd Qu.:", wind_summary["3rd Qu."], 
                      "Max:", wind_summary["Max."])
# Place the summary text below the boxplot
mtext(summary_text3, side = 1, line = 4, cex = 0.7)

boxplot(hum, main="Boxplot of Humidity", xlab="Humidity", horizontal = TRUE)
hum_summary <-summary(hum)
summary_text4 <- paste("Min:", hum_summary["Min."],
                      "1st Qu.:", hum_summary["1st Qu."], 
                      "Median:", hum_summary["Median"], 
                      "Mean:", hum_summary["Mean"],
                      "3rd Qu.:", hum_summary["3rd Qu."], 
                      "Max:", hum_summary["Max."])
# Place the summary text below the boxplot
mtext(summary_text4, side = 1, line = 4, cex = 0.7)
```

## Scatter Plots

```{r}
scatterplot(temp, cnt,
            xlab = "Temperature", 
            ylab = "Number of Bikes Rented", 
            main = "Scatter Plot of Number of Bikes Rented vs. Temperature")
scatterplot(atemp, cnt,
            xlab = "Feeling Temperature", 
            ylab = "Number of Bikes Rented", 
            main = "Scatter Plot of Number of Bikes Rented vs. Feeling Temperature")
scatterplot(hum, cnt,
            xlab = "Humidity", 
            ylab = "Number of Bikes Rented", 
            main = "Scatter Plot of Number of Bikes Rented vs. Humidity")
scatterplot(wind, cnt,
            xlab = "Wind Speed", 
            ylab = "Number of Bikes Rented", 
            main = "Scatter Plot of Number of Bikes Rented vs. Wind Speed")
```

## Residual Plots

```{r}
#draw the residual plot for each x covariate(tempeartue, feeling temprature, windspeed, humidity) vs y=cnt
model1 <- lm(cnt~temp, data=datasetBike)
res <- resid(model1)
plot(fitted(model1), res,
     xlab = "Temperature",
     ylab = "Number of Bikes Rented",
     main = "Residuals vs. Fitted Values Plot for Temperature")
abline(0,0)

model2 <- lm(cnt~atemp, data=datasetBike)
res2 <- resid(model2)
plot(fitted(model2), res2,
     xlab = "Feeling Temperature",
     ylab = "Number of Bikes Rented",
     main = "Residuals vs. Fitted Values Plot for Feeling Temperature")
abline(0,0)

model3 <- lm(cnt~wind, data=datasetBike)
res3 <- resid(model3)
plot(fitted(model3), res3,
     xlab = "Wind Speed",
     ylab = "Number of Bikes Rented",
     main = "Residuals vs. Fitted Values Plot for Wind Speed")
abline(0,0)

model4 <- lm(cnt~hum, data=datasetBike)
res4 <- resid(model4)
plot(fitted(model4), res4,
     xlab = "Humidity",
     ylab = "Number of Bikes Rented",
     main = "Residuals vs. Fitted Values Plot for Humidity")
abline(0,0)

library(car)
cat("For Temperatue \n")
ncvTest(model1)
cat("\nFor Feeling Temperature \n")
ncvTest(model2)
cat("\nFor Windspeed \n")
ncvTest(model3)
cat("\nFor Humidity \n")
ncvTest(model4)
```

We apply ncvTest in R. The test is known as **Breusch-Pagan test**, which is for testing heteroscedasticity.

**\*Heteroscedasticity** refers to a situation in a regression model where the variance of residuals or errors is not constant across all levels of the independent variable(s). It violates one of the key assumptions of ordinary least squares (OLS) regression, which is that the variance of the errors is constant (homoscedasticity).

\***P-value**: A **low p-value** (commonly below 0.05) suggests that we reject the null hypothesis, indicating the presence of heteroscedasticity (non-constant variance). A **high p-value**, as in this case, suggests that there is not enough evidence to reject the null hypothesis, indicating that the residuals can be considered homoscedastic (constant variance).

\***Null Hypothesis**: there is no heteroscedasticity (the model is constant variance).

Since for the above four covaraites, I made the linear regression model for each x v.s. y=cnt, get the residual plots for each, and use the Breusch_Pagan test to test if there is a heteroscedasticity. Because the model of (x = windspeed, y = cnt) has the lowest Chi-Square, and the highest p-value, we are failed to reject the null hypothesis. Thus, we may choose **Windspeed** as our **Covariate**.

## Residual Plots and QQ Plots

```{r}
library(ggplot2)

#fiting models for each of the variables
model_hum <- lm(cnt ~ hum, data = datasetBike)
model_wind <- lm(cnt ~ windspeed, data = datasetBike)
model_temp <- lm(cnt ~ temp, data = datasetBike)
model_atemp <- lm(cnt ~ atemp, data = datasetBike)

residuals_hum <- data.frame(Predicted = predict(model_hum), Residuals = residuals(model_hum))
residuals_wind <- data.frame(Predicted = predict(model_wind), Residuals = residuals(model_wind))
residuals_temp <- data.frame(Predicted = predict(model_temp), Residuals = residuals(model_temp))
residuals_atemp <- data.frame(Predicted = predict(model_atemp), Residuals = residuals(model_atemp))

###residual plots for each od the variables
#humidity
res_hum <- resid(model_hum)
plot(fitted(model_hum), res_hum, main="Fitted vs Residuals Plot for Humidity", xlab="Fitted Values", ylab="Residuals")
abline(0,0)
qqnorm(res_hum, main = "Q-Q Plot of Residuals for Humidity vs. # of Bikes Rented")
qqline(res_hum) 

#wind
res_wind <- resid(model_wind)
plot(fitted(model_wind), res_wind, main="Fitted vs Residuals Plot for Wind Speed", xlab="Fitted Values", ylab="Residuals")
abline(0,0)
qqnorm(res_wind, main = "Q-Q Plot of Residuals for Wind Speed vs. # of Bikes Rented")
qqline(res_wind) 

#temp
res_temp <- resid(model_temp)
plot(fitted(model_temp), res_temp, main="Fitted vs Residuals Plot for Temperature", xlab="Fitted Values", ylab="Residuals")
abline(0,0)
qqnorm(res_temp, main = "Q-Q Plot of Residuals for Temperature vs. # of Bikes Rented")
qqline(res_temp) 


#atemp
res_atemp <- resid(model_atemp)
plot(fitted(model_atemp), res_atemp, main="Fitted vs Residuals Plot for Feel-like temperature", xlab="Fitted Values", ylab="Residuals")
abline(0,0)
qqnorm(res_atemp, main = "Q-Q Plot of Residuals for Feeling Temprature vs. # of Bikes Rented")
qqline(res_atemp) 

```

## Some Transformations on the variables

```{r}
#log (y)
model3_t_1 <- lm(log(cnt) ~ hum, data=datasetBike)
res3_t_1 <- resid(model3_t_1)
plot(fitted(model3_t_1), res3_t_1,
     xlab = "Humidity",
     ylab = "Log of Number of Bike Rented",
     main = "Residuals vs. Fitted Values Plot for Linear Regression of Log Bike Count on Feeling Temperature")
abline(0,0)

tq3_t_1 <- qnorm(ppoints(length(res3_t_1)))
qqplot(tq3_t_1, res3_t_1, main = "Normal Q-Q Plot", xlab = "Theoretical Quantiles", ylab = "Sample Quantiles")
qqline(res3_t_1,col = "black")
plot

#sqrt both
model3_t_2 <- lm(sqrt(cnt) ~ sqrt(hum), data=datasetBike)
res3_t_2 <- resid(model3_t_2)
plot(fitted(model3_t_2), res3_t_2,
     xlab = "Square Root of Humidity",
     ylab = "Square Root of Number of Bike Rented",
     main = "Residuals vs. Fitted Values Plot for Linear Regression of Square Root Bike Count on Feeling Temperature")
abline(0,0)

tq3_t_2 <- qnorm(ppoints(length(res3_t_2)))
qqplot(tq3_t_2, res3_t_2, main = "Normal Q-Q Plot", xlab = "Theoretical Quantiles", ylab = "Sample Quantiles")
qqline(res3_t_2,col = "black")
plot

#sqrt y
model3_t_3 <- lm(sqrt(cnt) ~ hum, data=datasetBike)
res3_t_3 <- resid(model3_t_3)
plot(fitted(model3_t_3), res3_t_3,
     xlab = "Humidity",
     ylab = "Square Root of Number of Bike Rented",
     main = "Residuals vs. Fitted Values Plot for Linear Regression of Square Root Bike Count on Feeling Temperature")
abline(0,0)

tq3_t_3 <- qnorm(ppoints(length(res3_t_3)))
qqplot(tq3_t_3, res3_t_3, main = "Normal Q-Q Plot", xlab = "Theoretical Quantiles", ylab = "Sample Quantiles")
qqline(res3_t_3,col = "black")
plot
```

```{r}
model1 <- lm(cnt~temp, data=datasetBike)
res <- resid(model1)
plot(fitted(model1), res,
     xlab = "Temperature",
     ylab = "Number of Bikes Rented",
     main = "Residuals vs. Fitted Values Plot for Linear Regression of Bike Count on Temperature")
abline(0,0)

model2 <- lm(cnt~atemp, data=datasetBike)
res2 <- resid(model2)
plot(fitted(model2), res2,
     xlab = "Feeling Temperature",
     ylab = "Number of Bikes Rented",
     main = "Residuals vs. Fitted Values Plot for Linear Regression of Bike Count on Feeling Temperature")
abline(0,0)

tq1 <- qnorm(ppoints(length(res)))
qqplot(tq1, res, main = "Normal Q-Q Plot", xlab = "Theoretical Quantiles", ylab = "Sample Quantiles")
qqline(res,col = "black")
plot

tq2 <- qnorm(ppoints(length(res2)))
qqplot(tq2, res2, main = "Normal Q-Q Plot", xlab = "Theoretical Quantiles", ylab = "Sample Quantiles")
qqline(res2,col = "black")
plot
```

## Scatter Plots after some Transformations, Plots for Cook's Distance, Standardized Residuals

```{r}
#transforming humidity
  #scatterplot with box plot and line of best fit
  scatterplot(cnt~hum, data=datasetBike,
              xlab = "Humidity",
              ylab = "Number of Bikes Rented",
              main ="Humidity on number of bikes rented in entire study")
 
  
  #creating natural log of count variable and running a scatterplot
  #datasetBike$ln_hum <- log(datasetBike$hum)
  #scatterplot(cnt~ln_hum , data=datasetBike,
  #            xlab = "Natural log of humidity",
  #            ylab = "Number of Bikes Rented",
  #            main ="Natural log of humidity on number of bikes rented in entire study")
  #LOG TRANSFORM WONT WORK BECAUSE THERE ARE ZERO VALUES FOR HUMIDITY
  
  #trying a square root
  datasetBike$sqrt_hum <- sqrt(datasetBike $hum)
  scatterplot(cnt~sqrt_hum , data=datasetBike,
              xlab = "Square root of humidity",
              ylab = "Number of Bikes Rented",
              main ="Square root of humidity on number of bikes rented")
 
  #trying a square
  datasetBike$sq_hum <- datasetBike$hum ^ 2
  scatterplot(cnt~sq_hum , data=datasetBike,
              xlab = "Squared humidity",
              ylab = "Number of Bikes Rented",
              main ="Squared humidity on number of bikes rented")
 
# Fit a linear regression model of covariate on number of bikes rented
  #windspeed
  lm_wind<- lm(cnt ~ windspeed, data=datasetBike)
  summary(lm_wind)
 
  #humiditiy
  lm_hum<- lm(cnt ~ hum, data=datasetBike)
  summary(lm_hum)
 
  #temp
  lm_temp<- lm(cnt ~ temp, data=datasetBike)
  summary(lm_temp)
 
  #feeling temp
  lm_atemp<- lm(cnt ~ atemp, data=datasetBike)
  summary(lm_atemp)
 
# Calculate Cook's distance
  cooksd_wind <- cooks.distance(lm_wind)
  cooksd_hum <- cooks.distance(lm_hum)
  cooksd_temp<- cooks.distance(lm_temp)
  cooksd_atemp <- cooks.distance(lm_atemp)
 
# Print Cook's distances for each observation
  print(cooksd_wind)
  print(cooksd_hum)
  print(cooksd_temp)
  print(cooksd_atemp)
 
# Plot Cook's distances (influence points)
 
  #wind speed
  plot(cooksd_wind, pch=19, cex=1, main="Cook's distance plot for windspeed", xlab="Day", ylab="Cook's distance")
  # Add a horizontal line at the threshold value for identifying influential points
  abline(h = 4/length(cooksd_wind), col="red")
 
  #humidity
  plot(cooksd_hum, pch=19, cex=1, main="Cook's distance plot for humidity", xlab="Day", ylab="Cook's distance")
  abline(h = 4/length(cooksd_hum), col="red")
 
  #temp
  plot(cooksd_temp, pch=19, cex=1, main="Cook's distance plot for Temperature", xlab="Day", ylab="Cook's distance")
  abline(h = 4/length(cooksd_temp), col="red")
 
  #feeling temp
  plot(cooksd_atemp, pch=19, cex=1, main="Cook's distance plot for Feeling Temperature", xlab="Day", ylab="Cook's distance")
  abline(h = 4/length(cooksd_atemp), col="red")
 
#Plot fitted values vs standardized residuals (outliers)
  # Extract standardized residuals from the model
  sr_wind <- rstandard(lm_wind)
  sr_hum <- rstandard(lm_hum)
  sr_temp <- rstandard(lm_temp)
  sr_atemp <- rstandard(lm_atemp)
 
  # Extract fitted values from the model
  fv_wind <- fitted(lm_wind)
  fv_hum <- fitted(lm_hum)
  fv_temp <- fitted(lm_temp)
  fv_atemp <- fitted(lm_atemp)
 
  # Plot standardized residuals
 
  #wind speed
  plot(fv_wind,sr_wind, pch = 19, cex = 1, main = "Standardized Residuals Plot for Wind Speed",
       xlab = "Fitted value", ylab = "Standardized Residuals")
    # Add horizontal lines at y = 2 and y = -2
    abline(h = c(2, -2), col = "blue", lty = 2)
    # Add a horizontal line at y = 0 for reference
    abline(h = 0, col = "red")
 
  #humidity
  plot(fv_hum,sr_hum, pch = 19, cex = 1, main = "Standardized Residuals Plot for Humidity",
       xlab = "Fitted value", ylab = "Standardized Residuals")
  abline(h = c(2, -2), col = "blue", lty = 2)
  abline(h = 0, col = "red")
 
  #temp
  plot(fv_temp,sr_temp, pch = 19, cex = 1, main = "Standardized Residuals Plot for Temperature",
       xlab = "Fitted value", ylab = "Standardized Residuals")
  abline(h = c(2, -2), col = "blue", lty = 2)
  abline(h = 0, col = "red")
 
  #feeling temp
  plot(fv_atemp,sr_atemp, pch = 19, cex = 1, main = "Standardized Residuals Plot for Feeling Temperature",
       xlab = "Fitted value", ylab = "Standardized Residuals")
  abline(h = c(2, -2), col = "blue", lty = 2)
  abline(h = 0, col = "red")
 
#creating scatter plot with our regression line over it
 
  scatterplot(cnt ~ temp, data = datasetBike,
              xlab = "Temperature",
              ylab = "Number of Bikes Rented",
              main = "Scatter plot with Regression Line")
  abline(lm_temp, col = "red", lwd = 2)


```

## Report 3

## Descriptive Stats

```{r}
datasetBike
#For Casual Users
hist(casual, main = "Histogram of Number of Casual Users", xlab= "number casual users")
hist(sqrt(casual), main = "Histogram of SquareRoot of Number of Casual Users", xlab= "number casual users")

#For registered users
hist(registered, main = "Histogram of Number of Registered Users", xlab= "number registered users")
#hist(sqrt(registered), main = "Histogram of SquareRoot of Number of Casual Users", xlab= "number casual users")

#For WorkingDay
table(workingday)
  #the proportions of workingday
prop.table(table(workingday))

#For Season
table(season)
prop.table(table(season))

#For Year
table(yr)
prop.table(table(yr))

#For Holiday
table(holiday)
prop.table(table(holiday))

#For Weathersit
table(weather)
prop.table(table(weather))
#For normalized temperature(continuous)
```

## Correlation Matrix

```{r}
#install.packages("GGally")

# Load the GGally package

```

```{r}
library(GGally)
# Creating a new var, which is the log of casual users bc the dist'n is skewed
datasetBike$ln_casual <- log(casual)
datasetBike$sq_casual <- (casual^2)
datasetBike$sqrt_casual <- sqrt(casual)

#correlation matrix-temp
plot<-ggpairs(datasetBike[c('season', 'yr','mnth','weathersit','temp','atemp','windspeed','hum','casual', 'registered' ,'cnt')], 
        progress = F, 
        lower = list(continuous = wrap("points", alpha = 0.3, size=0.1)))+ 
  theme_grey(base_size = 5.6) + 
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        plot.caption = element_text(hjust = 0.5))
plot


```

```{r}
#correlation matrix-not temp
plot2<-ggpairs(datasetBike[c('yr','mnth','holiday','weekday','workingday','casual', 'registered' ,'cnt')], 
              progress = F, 
              lower = list(continuous = wrap("points", alpha = 0.3, size=0.1)))+
  theme_grey(base_size = 5.6) + 
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        plot.caption = element_text(hjust = 0.5))
print(plot2)
```

```{r}
#correlation matrix-temp with sqrt_causal 
plot3<-ggpairs(datasetBike[c('season', 'yr','mnth','weathersit','temp','atemp','windspeed','hum','sqrt_casual', 'registered' ,'cnt')], 
              progress = F, 
              lower = list(continuous = wrap("points", alpha = 0.3, size=0.1)))+ 
  theme_grey(base_size = 5.6) + 
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        plot.caption = element_text(hjust = 0.5))
print(plot3)
```

```{r}
#correlation matrix-not temp with sqrt_causal 
plot4<-ggpairs(datasetBike[c('yr','mnth','holiday','weekday','workingday','sqrt_casual', 'registered' ,'cnt')], 
               progress = F, 
               lower = list(continuous = wrap("points", alpha = 0.3, size=0.1)))+
  theme_grey(base_size = 5.6) + 
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        plot.caption = element_text(hjust = 0.5))
print(plot4)
```

```{r}
#install.packages("car")

library(car)
library(ggplot2)
```

```{r}
###SCATTER PLOTS FOR OUTCOME VAR
#scatterplot with box plot and line of best fit
scatterplot(cnt~instant, data=datasetBike,
            xlab = "Day", 
            ylab = "Number of Bikes Rented",
            main ="Day on number of bikes rented")
scatterplot(casual~instant, data=datasetBike,
            xlab = "Day", 
            ylab = "Number of casual users",
            main ="Day on number of casual users")
scatterplot(registered~instant, data=datasetBike,
            xlab = "Day", 
            ylab = "Number of registered users",
            main ="Day on number of registered users")
```

## Models for Answering Questions in Report 3

```{r}
#access R libraries needed
library(ggplot2)
library(readxl)
library(car)
library(GGally)
library(dplyr)


#Q1 chosen model registered users=B0+B1(workingday)+B2(year)+B3(weather)
model1 <- lm(registered~as.factor(workingday) + as.factor(yr) + as.factor(weather))
summary(model1)
#standardized residuals
sr_1 <- rstandard(model1)
fv_1 <- fitted(model1)
plot(fv_1,sr_1, pch = 19, cex = 1, main = "Standardized Residuals Plot for Registered Users",
     xlab = "Fitted value", ylab = "Standardized Residuals")
abline(h = c(2, -2), col = "blue", lty = 2)
abline(h = 0, col = "red")
#qq plot
qqnorm(sr_1, main = "Q-Q Plot of Residuals")
qqline(sr_1)
#ggplot of variable of main effects on model 1
new_data <- expand.grid(
  workingday = levels(as.factor(workingday)),
  yr = levels(as.factor(yr)),
  weather = levels(as.factor(weather))
)
new_data$predicted_registered <- predict(model1, newdata = new_data)
ggplot(new_data, aes(x = workingday, y = predicted_registered, fill = weather)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  facet_wrap(~yr) +
  labs(x = "Working Day", y = "Predicted Number of Registered Users", title = "Predicted Number of Registered Users") +
  theme_minimal()

#Q2 chosen model sqrt(casual users)= B0+ B1(season)+ B2(year)+ B3(weather)+ B4(working day)
model2 <- lm(sqrt(casual)~as.factor(season) + as.factor(yr) + as.factor(weather) + as.factor(workingday))
summary(model2)
#standardized residuals
sr_2 <- rstandard(model2)
fv_2 <- fitted(model2)
plot(fv_2,sr_2, pch = 19, cex = 1, main = "Standardized Residuals Plot for Square Root Casual Users",
     xlab = "Fitted value", ylab = "Standardized Residuals")
abline(h = c(2, -2), col = "blue", lty = 2)
abline(h = 0, col = "red")
#qq plot
qqnorm(sr_2, main = "Q-Q Plot of Residuals")
qqline(sr_2) 
#ggplot of variable of main effects on model 2
new_data <- expand.grid(
  season = levels(as.factor(season)),
  yr = levels(as.factor(yr)),
  weather = levels(as.factor(weather)),
  workingday = levels(as.factor(workingday))
)
new_data$predicted_sqrt_casual <- predict(model2, newdata = new_data)
ggplot(new_data, aes(x = season, y = predicted_sqrt_casual, fill = weather)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  facet_grid(yr ~ workingday) +
  labs(x = "Season", y = "Square Root Predicted Number of Casual Users", title = "Square Root Predicted Number of Casual Users") +
  theme_minimal()

#Q3 count of bikes rented =B0+ B1(temperature) +B2(windspeed)+ B3(humidity)+ B4(year) + B5(working day)
model3 <- lm(cnt ~  temp + wind + hum + as.factor(yr) + as.factor(workingday))
summary(model3)
#standardized residuals
sr_3 <- rstandard(model3)
fv_3 <- fitted(model3)
plot(fv_3,sr_3, pch = 19, cex = 1, main = "Standardized Residuals Plot for #Total Users",
     xlab = "Fitted value", ylab = "Standardized Residuals")
abline(h = c(2, -2), col = "blue", lty = 2)
abline(h = 0, col = "red")
#qq plot
qqnorm(sr_3, main = "Q-Q Plot of Residuals")
qqline(sr_3)
#scatterplots: temperature, windspeed, humidity (#1, #2, #3)
#1
scatterplot(cnt~temp, data = datasetBike,
            xlab = "Temperature",
            ylab = "#Total Users",
            main = "Scatter plot with Regression Line")
abline(model3, col = "red", lwd = 2)
#2
scatterplot(cnt~wind, data = datasetBike,
            xlab = "Windspeed",
            ylab = "#Total Users",
            main = "Scatter plot with Regression Line")
abline(model3, col = "red", lwd = 2)
#3
scatterplot(cnt~hum, data = datasetBike,
            xlab = "Humidity",
            ylab = "#Total Users",
            main = "Scatter plot with Regression Line")
abline(model3, col = "red", lwd = 2)
```
